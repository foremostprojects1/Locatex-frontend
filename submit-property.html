<!DOCTYPE html>
<html lang="zxx">
<head>
    <title>Locatex | Buy & Sell Real Estate</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">

    <!-- External CSS libraries -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-submenu.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-select.min.css">
    <link rel="stylesheet" href="css/leaflet.css" type="text/css">
    <link rel="stylesheet" href="css/map.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="fonts/flaticon/font/flaticon.css">
    <link rel="stylesheet" type="text/css" href="fonts/linearicons/style.css">
    <link rel="stylesheet" type="text/css"  href="css/jquery.mCustomScrollbar.css">
    <link rel="stylesheet" type="text/css"  href="css/dropzone.css">
    <link rel="stylesheet" type="text/css"  href="css/slick.css">

    <!-- Custom stylesheet -->
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" id="style_sheet" href="css/skins/default.css">

    <!-- Favicon icon -->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" >

    <!-- Google fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700%7CRoboto:300,400,500,700&display=swap">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link rel="stylesheet" type="text/css" href="css/ie10-viewport-bug-workaround.css">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="page_loader"></div>

<!-- Header Include -->
<div id="header-container"></div>

<script>
    // Load header.html content
    fetch('header.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('header-container').innerHTML = data;
        })
        .catch(error => {
            console.error('Error loading header:', error);
        });
</script>

<!-- Sub banner start -->
<div class="sub-banner">
    <div class="container">
        <div class="page-name">
            <h1 style="color: #000 !important;">Submit Property</h1>
            <ul style="color: #000 !important;">
                <li><a href="index.html" style="color: #000 !important;">Index</a></li>
                <li><span style="color: #000 !important;">/</span><span style="color: #000 !important;">Submit Property</span></li>
            </ul>
        </div>
    </div>
</div>

<!-- Submit Property start -->
<div class="submit-property content-area">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <!-- <div class="notification-box">
                    <h3>Don't Have an Account?</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ac tortor at tellus feugiat congue quis ut nunc. Semper ac dolor vitae accumsan.</p>
                </div> -->
            </div>
            <div class="col-md-12">
                <div class="submit-address">
                    <form method="GET">
                        <h3 class="heading-2">Basic Information</h3>
                        <div class="search-contents-sidebar mb-30">
                            <div class="row">
                                <div class="col-lg-4 col-md-6">
                                    <div class="form-group">
                                        <label>Property Title <span style="color: red;">*</span>
                                        </label>
                                        <input type="text" class="input-text" name="title" id="title" placeholder="Enter property title" required>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6">
                                    <div class="form-group">
                                        <label>Status <span style="color: red;">*</span></label>
                                        <select class="selectpicker search-fields" name="status" id="status" required>
                                            <option value="">Select Status</option>
                                            <option value="for-sale">For Sale</option>
                                            <option value="for-rent">For Rent</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6">
                                    <div class="form-group">
                                        <label>Type <span style="color: red;">*</span></label>
                                        <select class="selectpicker search-fields" name="type" id="propertyType" required>
                                            <option value="">Select Type</option>
                                            <option value="land">Land</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6">
                                    <div class="form-group">
                                        <label>Total Area (Vigha) <span style="color: red;">*</span></label>
                                        <input type="number" class="input-text" name="totalArea" id="totalArea" placeholder="Enter area in Vigha" required>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6" id="bhkContainer" style="display: none;">
                                    <div class="form-group">
                                        <label>BHK <span style="color: red;">*</span></label>
                                        <select class="selectpicker search-fields" name="bhk" id="bhk">
                                            <option value="">Select BHK</option>
                                            <option value="1">1 BHK</option>
                                            <option value="2">2 BHK</option>
                                            <option value="3">3 BHK</option>
                                            <option value="4">4 BHK</option>
                                            <option value="5">5 BHK</option>
                                            <option value="6">6 BHK</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6" id="bathroomsContainer" style="display: none;">
                                    <div class="form-group">
                                        <label>Bathrooms</label>
                                        <select class="selectpicker search-fields" name="bathrooms" id="bathrooms">
                                            <option value="">Select</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6" id="balconiesContainer" style="display: none;">
                                    <div class="form-group">
                                        <label>Balconies</label>
                                        <select class="selectpicker search-fields" name="balconies" id="balconies">
                                            <option value="">Select</option>
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6" id="carParkingContainer" style="display: none;">
                                    <div class="form-group">
                                        <label>Allocated Car Parking</label>
                                        <select class="selectpicker search-fields" name="carParking" id="carParking">
                                            <option value="">Select Parking</option>
                                            <option value="1">1 Car</option>
                                            <option value="2">2 Cars</option>
                                            <option value="3">3 Cars</option>
                                            <option value="4">4+ Cars</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6">
                                    <div class="form-group">
                                        <label>Total Price <span style="color: red;">*</span></label>
                                        <input type="number" class="input-text" name="price" id="price" placeholder="Enter price" required>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6" id="buildingAgeContainer" style="display: none;">
                                    <div class="form-group">
                                        <label>Building Age</label>
                                        <select class="selectpicker search-fields" name="buildingAge" id="buildingAge">
                                            <option value="">Select Building Age</option>
                                            <option value="0-1">0-1 Years</option>
                                            <option value="1-5">1-5 Years</option>
                                            <option value="5-10">5-10 Years</option>
                                            <option value="10-20">10-20 Years</option>
                                            <option value="20-40">20-40 Years</option>
                                            <option value="40+">40+ Years</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h3 class="heading-2">Property Gallery (8-10 Photos)</h3>
                        <div id="myDropZone" class="dropzone dropzone-design mb-50">
                            <div class="dz-default dz-message">
                                <span>Drop files here to upload (8-10 photos recommended)</span>
                                <p class="text-muted">Supported formats: JPG, PNG, GIF. Max 5MB per image.</p>
                            </div>
                        </div>
                        <!-- Land Area Fields (for Land type)
                        <div id="landAreaContainer" style="display: none;">
                            <h3 class="heading-2">Land Area</h3>
                            <div class="row mb-30">
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        <label>Area in Vigha</label>
                                        <input type="number" class="input-text" name="areaVigha" id="areaVigha" placeholder="Enter area in Vigha" step="0.01">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        <label>Area in Acre</label>
                                        <input type="number" class="input-text" name="areaAcre" id="areaAcre" placeholder="Enter area in Acre" step="0.01">
                                    </div>
                                </div>
                            </div>
                        </div> -->

                        <h3 class="heading-2">Location</h3>
                        <div class="row mb-30">
                            <div class="col-lg-4 col-md-4">
                                <div class="form-group">
                                    <label>Address <span style="color: red;">*</span></label>
                                    <input type="text" class="input-text" name="address" id="address" placeholder="Enter full address" required>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4">
                                <div class="form-group">
                                    <label>City <span style="color: red;">*</span></label>
                                    <select class="selectpicker search-fields" data-live-search="true" name="city" id="city" required>
                                        <option value="">Choose City</option>
                                        <option value="Ahmedabad">Ahmedabad</option>
                                        <option value="Mumbai">Mumbai</option>
                                        <option value="Delhi">Delhi</option>
                                        <option value="Bengaluru">Bengaluru</option>
                                        <option value="Hyderabad">Hyderabad</option>
                                        <option value="Chennai">Chennai</option>
                                        <option value="Kolkata">Kolkata</option>
                                        <option value="Pune">Pune</option>
                                        <option value="Jaipur">Jaipur</option>
                                        <option value="Surat">Surat</option>
                                        <option value="Lucknow">Lucknow</option>
                                        <option value="Indore">Indore</option>
                                        <option value="Bhopal">Bhopal</option>
                                        <option value="Nagpur">Nagpur</option>
                                        <option value="Vadodara">Vadodara</option>
                                        <option value="Rajkot">Rajkot</option>
                                        <option value="Thane">Thane</option>
                                        <option value="Nashik">Nashik</option>
                                        <option value="Other">Other (Custom)</option>
                                    </select>
                                    <input type="text" class="input-text mt-2" id="customCity" placeholder="Enter your city" style="display:none;">
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4">
                                <div class="form-group">
                                    <label>State <span style="color: red;">*</span></label>
                                    <select class="selectpicker search-fields" name="state" id="state" required>
                                        <option value="">Choose State</option>
                                 
                                        <!-- States -->
                                        <option value="andhra-pradesh">Andhra Pradesh</option>
                                        <option value="arunachal-pradesh">Arunachal Pradesh</option>
                                        <option value="assam">Assam</option>
                                        <option value="bihar">Bihar</option>
                                        <option value="chhattisgarh">Chhattisgarh</option>
                                        <option value="goa">Goa</option>
                                        <option value="gujarat">Gujarat</option>
                                        <option value="haryana">Haryana</option>
                                        <option value="himachal-pradesh">Himachal Pradesh</option>
                                        <option value="jharkhand">Jharkhand</option>
                                        <option value="karnataka">Karnataka</option>
                                        <option value="kerala">Kerala</option>
                                        <option value="madhya-pradesh">Madhya Pradesh</option>
                                        <option value="maharashtra">Maharashtra</option>
                                        <option value="manipur">Manipur</option>
                                        <option value="meghalaya">Meghalaya</option>
                                        <option value="mizoram">Mizoram</option>
                                        <option value="nagaland">Nagaland</option>
                                        <option value="odisha">Odisha</option>
                                        <option value="punjab">Punjab</option>
                                        <option value="rajasthan">Rajasthan</option>
                                        <option value="sikkim">Sikkim</option>
                                        <option value="tamil-nadu">Tamil Nadu</option>
                                        <option value="telangana">Telangana</option>
                                        <option value="tripura">Tripura</option>
                                        <option value="uttar-pradesh">Uttar Pradesh</option>
                                        <option value="uttarakhand">Uttarakhand</option>
                                        <option value="west-bengal">West Bengal</option>
                                 
                                        <!-- Union Territories -->
                                        <option value="andaman-nicobar-islands">Andaman and Nicobar Islands</option>
                                        <option value="chandigarh">Chandigarh</option>
                                        <option value="dadra-nagar-haveli-daman-diu">Dadra and Nagar Haveli and Daman and Diu</option>
                                        <option value="delhi">Delhi</option>
                                        <option value="jammu-kashmir">Jammu and Kashmir</option>
                                        <option value="ladakh">Ladakh</option>
                                        <option value="lakshadweep">Lakshadweep</option>
                                        <option value="puducherry">Puducherry</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4">
                                <div class="form-group">
                                    <label>Zip Code</label>
                                    <input type="text" class="input-text" name="zipCode" id="zipCode" placeholder="Enter zip code">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Google Maps Location Picker -->
                        <div class="row mb-30">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>Select Google Map Location <span style="color: red;">*</span></label>
                                    <div id="map" style="height: 400px; width: 100%; border: 1px solid #ddd;"></div>
                                    <input type="hidden" name="latitude" id="latitude" required>
                                    <input type="hidden" name="longitude" id="longitude" required>
                                </div>
                            </div>
                        </div>
                        <h3 class="heading-2">Detailed Information</h3>
                        <div class="row mb-50">
                            <div class="col-md-12">
                                <div class="form-group mb-0">
                                    <label>Detailed Information</label>
                                    <textarea class="input-text" name="message" placeholder="Detailed Information"></textarea>
                                </div>
                            </div>
                        </div>
                        <!-- Land Specific Questions -->
                        <div id="landQuestionsContainer">
                            <h3 class="heading-2">Land Information</h3>
                            <div class="row mb-40">
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        <label>Fencing and wall of boundaries?</label>
                                        <select class="selectpicker search-fields" name="fencing" id="fencing">
                                            <option value="">Select</option>
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        <label>Borewell or well available?</label>
                                        <select class="selectpicker search-fields" name="borewell" id="borewell">
                                            <option value="">Select</option>
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        <label>Any house in land to stay?</label>
                                        <select class="selectpicker search-fields" name="houseOnLand" id="houseOnLand">
                                            <option value="">Select</option>
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        <label>Electricity connection?</label>
                                        <select class="selectpicker search-fields" name="electricity" id="electricity">
                                            <option value="">Select</option>
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- <h3 class="heading-2">Amenities (optional)</h3>
                        <div class="row mb-40">
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-4 col-md-4 col-sm-4">
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            <input id="checkbox1" type="checkbox" name="amenities" value="free-parking">
                                            <label for="checkbox1">
                                                Free Parking
                                            </label>
                                        </div>
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            <input id="checkbox2" type="checkbox" name="amenities" value="air-condition">
                                            <label for="checkbox2">
                                                Air Condition
                                            </label>
                                        </div>
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            <input id="checkbox3" type="checkbox" name="amenities" value="places-to-seat">
                                            <label for="checkbox3">
                                                Places to seat
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-4">
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            <input id="checkbox4" type="checkbox" name="amenities" value="swimming-pool">
                                            <label for="checkbox4">
                                                Swimming Pool
                                            </label>
                                        </div>
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            <input id="checkbox5" type="checkbox" name="amenities" value="laundry-room">
                                            <label for="checkbox5">
                                                Laundry Room
                                            </label>
                                        </div>
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            <input id="checkbox6" type="checkbox" name="amenities" value="window-covering">
                                            <label for="checkbox6">
                                                Window Covering
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-4">
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            <input id="checkbox7" type="checkbox" name="amenities" value="central-heating">
                                            <label for="checkbox7">
                                                Central Heating
                                            </label>
                                        </div>
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            <input id="checkbox8" type="checkbox" name="amenities" value="fire-alarm">
                                            <label for="checkbox8">
                                                Fire Alarm
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->

                        <!-- Document Upload Section -->
                        <h3 class="heading-2">Property Documents</h3>
                        <div class="row mb-40">
                            <div class="col-lg-6 col-md-6">
                                <div class="form-group">
                                    <label>7 Document (PDF)</label>
                                    <input type="file" class="form-control" name="document712" id="document712" accept=".pdf">
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <div class="form-group">
                                    <label>8A Document (PDF)</label>
                                    <input type="file" class="form-control" name="document8A" id="document8A" accept=".pdf">
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <div class="form-group">
                                    <label>Utarotar Document (PDF)</label>
                                    <input type="file" class="form-control" name="documentUtarotar" id="documentUtarotar" accept=".pdf">
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <div class="form-group">
                                    <label>12 Document (PDF)</label>
                                    <input type="file" class="form-control" name="otherDocuments" id="otherDocuments" accept=".pdf" multiple>
                                </div>
                            </div>
                        </div>
                        <h3 class="heading-2">Contact Details</h3>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Name <span style="color: red;">*</span></label>
                                    <input type="text" class="input-text" name="contactName" id="contactName" placeholder="Your Name" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Email <span style="color: red;">*</span></label>
                                    <input type="email" class="input-text" name="contactEmail" id="contactEmail" placeholder="Your Email" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Phone Number <span style="color: red;">*</span></label>
                                    <input type="tel" class="input-text" name="contactPhone" id="contactPhone" placeholder="Your Phone Number" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>WhatsApp Number</label>
                                    <input type="tel" class="input-text" name="whatsappNumber" id="whatsappNumber" placeholder="WhatsApp Number">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <button type="submit" class="btn btn-md button-theme mb-30" id="submitPropertyBtn">
                                    <span id="submitText">Submit Property</span>
                                    <span id="submitLoader" style="display: none;">
                                        <i class="fa fa-spinner fa-spin"></i> Submitting...
                                    </span>
                                </button>
                                <!-- <button type="button" class="btn btn-md btn-secondary mb-30 ml-2" id="previewBtn">Preview</button> -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Full Screen Loader Popup -->
<div id="fullscreenLoader" class="fullscreen-loader" style="display: none;">
    <div class="loader-content">
        <div class="loader-animation">
            <div class="loader-circle"></div>
            <div class="loader-circle"></div>
            <div class="loader-circle"></div>
        </div>
        <div class="loader-text">
            <h3>Submitting Property...</h3>
            <p>Please wait while we process your property details and upload files</p>
            <div class="loader-progress">
                <div class="progress-bar"></div>
            </div>
        </div>
    </div>
</div>

<style>
.fullscreen-loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
}

.loader-content {
    text-align: center;
    color: white;
    max-width: 400px;
    padding: 40px;
}

.loader-animation {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 30px;
}

.loader-circle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
    margin: 0 10px;
    animation: bounce 1.4s ease-in-out infinite both;
}

.loader-circle:nth-child(1) {
    animation-delay: -0.32s;
}

.loader-circle:nth-child(2) {
    animation-delay: -0.16s;
}

.loader-circle:nth-child(3) {
    animation-delay: 0s;
}

@keyframes bounce {
    0%, 80%, 100% {
        transform: scale(0);
    }
    40% {
        transform: scale(1);
    }
}

.loader-text h3 {
    font-size: 24px;
    margin-bottom: 15px;
    color: #fff;
    font-weight: 600;
}

.loader-text p {
    font-size: 16px;
    margin-bottom: 25px;
    color: #ccc;
    line-height: 1.5;
}

.loader-progress {
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 20px;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
    border-radius: 2px;
    animation: progress 2s ease-in-out infinite;
}

/* Fix Google Places autocomplete dropdown text color */
.pac-container {
    background-color: #fff !important;
    border: 1px solid #ddd !important;
    z-index: 9999 !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}
.pac-item {
    color: #333 !important;
    background-color: #fff !important;
    padding: 10px 12px !important;
    border-bottom: 1px solid #eee !important;
    cursor: pointer !important;
}
.pac-item:hover,
.pac-item-selected {
    background-color: #f8f9fa !important;
    color: #000 !important;
}
.pac-item-query {
    color: #333 !important;
    font-weight: 400 !important;
}
.pac-item-query strong,
.pac-matched {
    color: #007bff !important;
    font-weight: 600 !important;
    background-color: rgba(0, 123, 255, 0.1) !important;
    padding: 1px 2px !important;
    border-radius: 2px !important;
}
.pac-icon {
    margin-right: 8px !important;
    filter: grayscale(0.3);
    opacity: 0.8 !important;
}

/* Ensure all Google Places text is visible */
.pac-container * {
    color: #333 !important;
}
.pac-container .pac-item-query strong {
    color: #007bff !important;
}

@keyframes progress {
    0% {
        width: 0%;
        transform: translateX(-100%);
    }
    50% {
        width: 100%;
        transform: translateX(0%);
    }
    100% {
        width: 100%;
        transform: translateX(100%);
    }
}

/* Responsive */
@media (max-width: 768px) {
    .loader-content {
        padding: 20px;
        max-width: 300px;
    }
    
    .loader-text h3 {
        font-size: 20px;
    }
    
    .loader-text p {
        font-size: 14px;
    }
}
</style>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer start -->
<div id="footer-container"></div>

<script>
    // Load footer.html content
    fetch('footer.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('footer-container').innerHTML = data;
        })
        .catch(error => {
            console.error('Error loading footer:', error);
        });
</script>

<script src="js/jquery-2.2.0.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap-submenu.js"></script>
<script src="js/rangeslider.js"></script>
<script src="js/jquery.mb.YTPlayer.js"></script>
<script src="js/wow.min.js"></script>
<script src="js/bootstrap-select.min.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/jquery.scrollUp.js"></script>
<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="js/leaflet.js"></script>
<script src="js/leaflet-providers.js"></script>
<script src="js/leaflet.markercluster.js"></script>
<script src="js/dropzone.js"></script>
<script src="js/slick.min.js"></script>
<script src="js/jquery.filterizr.js"></script>
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="js/jquery.countdown.js"></script>
<script src="js/maps.js"></script>
<script src="js/app.js"></script>

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="js/ie10-viewport-bug-workaround.js"></script>

<!-- Google Maps API -->
<!-- Replace YOUR_GOOGLE_MAPS_API_KEY with your actual Google Maps API key -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASvsUsXr5DtzDSLKvk5Tzc439i8k3fOfM&libraries=places"></script>

<script>
// Property Type Change Handler
document.getElementById('propertyType').addEventListener('change', function() {
    const propertyType = this.value;
    const bhkContainer = document.getElementById('bhkContainer');
    const carParkingContainer = document.getElementById('carParkingContainer');
    const landAreaContainer = document.getElementById('landAreaContainer');
    const landQuestionsContainer = document.getElementById('landQuestionsContainer');
    const buildingAgeContainer = document.getElementById('buildingAgeContainer');
    
    // Hide all conditional containers first
    bhkContainer.style.display = 'none';
    carParkingContainer.style.display = 'none';
    landAreaContainer.style.display = 'none';
    landQuestionsContainer.style.display = 'none';
    buildingAgeContainer.style.display = 'none';
    
    // Show relevant containers based on property type
    if (propertyType === 'house' || propertyType === 'apartment') {
        bhkContainer.style.display = 'block';
        buildingAgeContainer.style.display = 'block';
        bathroomsContainer.style.display = 'block';
        balconiesContainer.style.display = 'block';
        if (propertyType === 'apartment') {
            carParkingContainer.style.display = 'block';
        }
    } else if (propertyType === 'commercial' || propertyType === 'industrial') {
        buildingAgeContainer.style.display = 'block';
        bathroomsContainer.style.display = 'none';
        balconiesContainer.style.display = 'none';
    } else if (propertyType === 'land') {
        landAreaContainer.style.display = 'block';
        landQuestionsContainer.style.display = 'block';
        bathroomsContainer.style.display = 'none';
        balconiesContainer.style.display = 'none';
    }
});

// Google Maps Integration
let map;
let marker;
let geocoder;

function initMap() {
    try {
        // Default location (India centroid)
        const defaultLocation = { lat: 22.9734, lng: 78.6569 };
        
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 13,
            center: defaultLocation
        });
        geocoder = new google.maps.Geocoder();
        
        marker = new google.maps.Marker({
            position: defaultLocation,
            map: map,
            draggable: true
        });
        
        // Update hidden fields when marker is moved
        marker.addListener('dragend', function() {
            const position = marker.getPosition();
            document.getElementById('latitude').value = position.lat();
            document.getElementById('longitude').value = position.lng();
            // Try to update city/state from marker position
            try {
                geocoder.geocode({ location: position }, function(results, status){
                    if(status === 'OK' && results && results[0]){
                        var parts = results[0].address_components || [];
                        var cityComp = parts.find(function(c){ return c.types && (c.types.indexOf('locality')>-1 || c.types.indexOf('administrative_area_level_2')>-1); });
                        var stateComp = parts.find(function(c){ return c.types && c.types.indexOf('administrative_area_level_1')>-1; });
                        if (cityComp) { document.getElementById('city').value = cityComp.long_name; }
                        if (stateComp) {
                            var stateSel = document.getElementById('state');
                            if(stateSel){
                                // Try match by text content if value differs
                                var target = stateComp.long_name.toLowerCase().replace(/\s+/g,'-');
                                var found = Array.prototype.find.call(stateSel.options, function(o){ return (o.value===target) || (o.text.toLowerCase()===stateComp.long_name.toLowerCase()); });
                                if(found){ stateSel.value = found.value; }
                            }
                        }
                        // Refresh selectpicker if present
                        if(window.jQuery && jQuery.fn.selectpicker){ jQuery('#city,#state').selectpicker('refresh'); }
                    }
                });
            } catch(e) {}
        });
        
        // Update marker when map is clicked
        map.addListener('click', function(event) {
            marker.setPosition(event.latLng);
            document.getElementById('latitude').value = event.latLng.lat();
            document.getElementById('longitude').value = event.latLng.lng();
            // Reverse geocode to try filling address/city/state
            try {
                geocoder.geocode({ location: event.latLng }, function(results, status){
                    if(status === 'OK' && results && results[0]){
                        var addr = results[0].formatted_address || '';
                        var parts = results[0].address_components || [];
                        var cityComp = parts.find(function(c){ return c.types && (c.types.indexOf('locality')>-1 || c.types.indexOf('administrative_area_level_2')>-1); });
                        var stateComp = parts.find(function(c){ return c.types && c.types.indexOf('administrative_area_level_1')>-1; });
                        if(addr){ var a=document.getElementById('address'); if(a){ a.value = addr; } }
                        if (cityComp) { setCitySelect(cityComp.long_name); }
                        if (stateComp) {
                            var stateSel = document.getElementById('state');
                            if(stateSel){
                                var target = stateComp.long_name.toLowerCase().replace(/\s+/g,'-');
                                var found = Array.prototype.find.call(stateSel.options, function(o){ return (o.value===target) || (o.text.toLowerCase()===stateComp.long_name.toLowerCase()); });
                                if(found){ stateSel.value = found.value; }
                            }
                        }
                        if(window.jQuery && jQuery.fn.selectpicker){ jQuery('#city,#state').selectpicker('refresh'); }
                    }
                });
            } catch(e) {}
        });
        
        // Set initial values
        document.getElementById('latitude').value = defaultLocation.lat;
        document.getElementById('longitude').value = defaultLocation.lng;

        // Helper to set City select by matching option text/value; fallback to Other + custom
        function setCitySelect(fromName){
            try{
                var citySel = document.getElementById('city');
                var customCity = document.getElementById('customCity');
                if(!citySel || !fromName) return;
                var target = String(fromName).trim();
                var opts = Array.prototype.slice.call(citySel.options||[]);
                // exact match by value
                var found = opts.find(function(o){ return String(o.value).toLowerCase() === target.toLowerCase(); });
                // match by text if not found
                if(!found){ found = opts.find(function(o){ return String(o.text).toLowerCase() === target.toLowerCase(); }); }
                if(found){
                    citySel.value = found.value;
                    if(window.jQuery && jQuery.fn.selectpicker){ jQuery('#city').selectpicker('refresh'); }
                    if(customCity){ customCity.style.display='none'; customCity.value=''; }
                } else {
                    // fallback to Other + custom city text
                    var other = opts.find(function(o){ return o.value === 'Other'; });
                    if(other){ citySel.value = 'Other'; if(window.jQuery && jQuery.fn.selectpicker){ jQuery('#city').selectpicker('refresh'); } }
                    if(customCity){ customCity.style.display=''; customCity.value = target; }
                }
            }catch(e){ console.warn('setCitySelect failed', e); }
        }

        // Places Autocomplete for address
        try {
            var addressInput = document.getElementById('address');
            if(addressInput){
                var autocomplete = new google.maps.places.Autocomplete(addressInput, { componentRestrictions: { country: 'in' } });
                autocomplete.addListener('place_changed', function(){
                    var place = autocomplete.getPlace();
                    if(place && place.geometry && place.geometry.location){
                        var loc = place.geometry.location;
                        map.setCenter(loc);
                        map.setZoom(15);
                        marker.setPosition(loc);
                        document.getElementById('latitude').value = loc.lat();
                        document.getElementById('longitude').value = loc.lng();
                        // Attempt to set city/state from place
                        var parts = (place.address_components||[]);
                        var cityComp = parts.find(function(c){ return c.types && (c.types.indexOf('locality')>-1 || c.types.indexOf('administrative_area_level_2')>-1); });
                        var stateComp = parts.find(function(c){ return c.types && c.types.indexOf('administrative_area_level_1')>-1; });
                        if (cityComp) { setCitySelect(cityComp.long_name); }
                        if (stateComp) {
                            var stateSel = document.getElementById('state');
                            if(stateSel){
                                var target = stateComp.long_name.toLowerCase().replace(/\s+/g,'-');
                                var found = Array.prototype.find.call(stateSel.options, function(o){ return (o.value===target) || (o.text.toLowerCase()===stateComp.long_name.toLowerCase()); });
                                if(found){ stateSel.value = found.value; }
                            }
                        }
                        if(window.jQuery && jQuery.fn.selectpicker){ jQuery('#city,#state').selectpicker('refresh'); }
                    }
                });

                // Prevent form submission when Enter is pressed in address field
                addressInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        e.stopPropagation();
                        // Let Google Places handle the selection after a brief delay
                        setTimeout(function() {
                            if (autocomplete.getPlace && autocomplete.getPlace().geometry) {
                                google.maps.event.trigger(autocomplete, 'place_changed');
                            }
                        }, 10);
                        return false;
                    }
                });

                // Also prevent form submission at form level when address field is focused
                var form = document.querySelector('form');
                if (form) {
                    form.addEventListener('keydown', function(e) {
                        if (e.target.id === 'address' && e.key === 'Enter') {
                            e.preventDefault();
                            e.stopPropagation();
                            return false;
                        }
                    });
                }
            }
        } catch(e) { console.warn('Autocomplete init failed', e); }
        
        console.log('Google Maps initialized successfully');
    } catch (error) {
        console.error('Google Maps initialization failed:', error);
        showMapError();
    }
}

function showMapError() {
    const mapContainer = document.getElementById('map');
    mapContainer.innerHTML = `
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 400px; background: #f8f9fa; border: 2px dashed #dee2e6; color: #6c757d;">
            <i class="fa fa-map-marker" style="font-size: 48px; margin-bottom: 16px;"></i>
            <h4>Map Not Available</h4>
            <p>Please enter coordinates manually or contact support.</p>
            <div style="margin-top: 16px;">
                <input type="number" id="manualLat" placeholder="Latitude" style="margin-right: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <input type="number" id="manualLng" placeholder="Longitude" style="margin-right: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <button onclick="setManualCoordinates()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Set</button>
            </div>
        </div>
    `;
}

function setManualCoordinates() {
    const lat = document.getElementById('manualLat').value;
    const lng = document.getElementById('manualLng').value;
    if (lat && lng) {
        document.getElementById('latitude').value = lat;
        document.getElementById('longitude').value = lng;
        alert('Coordinates set successfully!');
    } else {
        alert('Please enter both latitude and longitude.');
    }
}

// Initialize map when page loads
if (typeof google !== 'undefined' && google.maps) {
    google.maps.event.addDomListener(window, 'load', initMap);
} else {
    // Fallback if Google Maps API fails to load
    window.addEventListener('load', function() {
        setTimeout(function() {
            if (typeof google === 'undefined' || !google.maps) {
                showMapError();
            }
        }, 3000); // Wait 3 seconds for Google Maps to load
    });
}

// City -> Map sync
document.addEventListener('DOMContentLoaded', function() {
    var citySelect = document.getElementById('city');
    var customCity = document.getElementById('customCity');
    
    // Ensure "Other" option is always the last item and visible without search
    (function ensureOtherLast() {
        var opts = Array.prototype.slice.call(citySelect.options || []);
        var otherIdx = opts.findIndex(function(o){ return o && o.value === 'Other'; });
        if (otherIdx > -1 && otherIdx !== opts.length - 1) {
            var other = opts[otherIdx];
            citySelect.remove(otherIdx);
            citySelect.add(other);
        }
        if (window.jQuery && jQuery.fn.selectpicker) {
            jQuery('#city').selectpicker('refresh');
        }
    })();

    function geocodeAndCenter(cityName) {
        if (!cityName || !geocoder || !map || !marker) return;
        geocoder.geocode({ address: cityName + ', India' }, function(results, status) {
            if (status === 'OK' && results && results[0]) {
                var loc = results[0].geometry.location;
                map.setCenter(loc);
                map.setZoom(12);
                marker.setPosition(loc);
                document.getElementById('latitude').value = loc.lat();
                document.getElementById('longitude').value = loc.lng();
            }
        });
    }

    function handleCityChange() {
        var val = citySelect.value;
        if (val === 'Other') {
            customCity.style.display = '';
            customCity.focus();
        } else {
            customCity.style.display = 'none';
            geocodeAndCenter(val);
        }
    }

    citySelect.addEventListener('changed.bs.select', handleCityChange);
    citySelect.addEventListener('change', handleCityChange);

    customCity.addEventListener('blur', function(){
        if (customCity.value.trim()) {
            geocodeAndCenter(customCity.value.trim());
        }
    });

    // When searching cities, if no results, show a quick action to use custom city
    if (window.jQuery && jQuery.fn.selectpicker) {
        var $city = jQuery('#city');
        $city.on('shown.bs.select', function() {
            var picker = $city.data('selectpicker');
            if (!picker || !picker.$menu) return;
            var $menu = picker.$menu;
            var $search = $menu.find('.bs-searchbox input');
            // remove previous handlers
            $search.off('input.customCity');
            $search.on('input.customCity', function() {
                var q = (this.value || '').trim();
                // Wait for filter to render
                setTimeout(function() {
                    var $no = $menu.find('li.no-results');
                    // Create or update custom suggestion row
                    var $custom = $menu.find('li.other-custom');
                    if ($no.length && q) {
                        if ($custom.length === 0) {
                            $custom = jQuery('<li class="other-custom"><a role="option" class="dropdown-item"></a></li>');
                            $menu.find('ul.inner').append($custom);
                            $custom.on('click', function(e){
                                e.preventDefault();
                                // Select Other and set custom city value
                                $city.selectpicker('val', 'Other');
                                customCity.style.display = '';
                                // Read latest typed text from the live-search box to avoid truncation
                                var latest = ($menu.find('.bs-searchbox input').val() || '').trim();
                                customCity.value = latest || q;
                                customCity.focus();
                                picker.$button.click(); // close menu
                            });
                        }
                        $custom.find('a').text('Use custom city: "' + q + '"');
                        $custom.show();
                    } else if ($custom.length) {
                        $custom.hide();
                    }
                }, 0);
            });
        });
    }
});

document.addEventListener('DOMContentLoaded', async function () {
  const urlParams = new URLSearchParams(window.location.search);
  const propertyId = urlParams.get('id');
  const form = document.getElementById('propertyForm');
  const submitBtn = document.getElementById('submitBtn');

  // Detect edit mode
  const isEditMode = !!propertyId;
  if (isEditMode) {
    submitBtn.textContent = 'Update Property';
  }

  const token = localStorage.getItem('token');

  // ---------------------------
  // Load Property (Edit Mode)
  // ---------------------------
  if (isEditMode) {
    try {
      const res = await fetch(`/api/properties/${propertyId}`, {
        headers: { 'Authorization': `Bearer ${token}` },
      });
      const data = await res.json();

      if (data.status === 'success') {
        const property = data.data.property;

        // Fill input fields
        document.getElementById('title').value = property.title || '';
        document.getElementById('price').value = property.price || '';
        document.getElementById('type').value = property.type || '';
        document.getElementById('status').value = property.status || '';
        document.getElementById('address').value = property.location?.address || '';
        document.getElementById('city').value = property.location?.city || '';
        document.getElementById('state').value = property.location?.state || '';
        document.getElementById('zipCode').value = property.location?.zipCode || '';
        document.getElementById('description').value = property.description || '';

        // Check amenities (checkbox list)
        if (Array.isArray(property.amenities)) {
          property.amenities.forEach(a => {
            const checkbox = document.querySelector(`input[name="amenities"][value="${a}"]`);
            if (checkbox) checkbox.checked = true;
          });
        }

        // Initialize map if coordinates exist
        if (property.location?.coordinates) {
          const lat = Number(property.location.coordinates.latitude?.$numberDouble || property.location.coordinates.latitude);
          const lng = Number(property.location.coordinates.longitude?.$numberDouble || property.location.coordinates.longitude);
          if (!isNaN(lat) && !isNaN(lng)) initMap(lat, lng);
        }

        // Load existing images (if your Dropzone supports it)
        if (property.images?.length) {
          property.images.forEach(img => {
            const mockFile = { name: img.alt || 'Image', size: 12345, dataURL: img.url };
            myDropzone.emit('addedfile', mockFile);
            myDropzone.emit('thumbnail', mockFile, img.url);
            myDropzone.emit('complete', mockFile);
          });
        }
      } else {
        console.error('Failed to fetch property:', data.message);
      }
    } catch (err) {
      console.error('Error loading property data:', err);
    }
  }

  // ---------------------------
  // Handle Form Submission
  // ---------------------------
  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const formData = new FormData(form);
    const method = isEditMode ? 'PUT' : 'POST';
    const url = isEditMode
      ? `/api/properties/${propertyId}`
      : '/api/properties';

    try {
      const response = await fetch(url, {
        method,
        headers: { 'Authorization': `Bearer ${token}` },
        body: formData,
      });

      const result = await response.json();
      if (result.status === 'success' || result.success) {
        alert(isEditMode ? 'Property updated successfully!' : 'Property created successfully!');
        window.location.href = '/my-properties.html';
      } else {
        alert('Error: ' + (result.message || 'Failed to submit property.'));
      }
    } catch (err) {
      console.error('Submit error:', err);
      alert('Something went wrong. Please try again.');
    }
  });
});

// Dropzone Configuration
Dropzone.autoDiscover = false;

const myDropzone = new Dropzone("#myDropZone", {
    url: "#", // Disable auto-upload
    paramName: "images",
    maxFiles: 10,
    maxFilesize: 5, // MB
    acceptedFiles: "image/*",
    addRemoveLinks: true,
    dictRemoveFile: "Remove",
    previewsContainer: "#myDropZone",
    clickable: true,
    autoProcessQueue: false, // Don't auto-upload files
    dictDefaultMessage: "Drop files here to upload (8-10 photos recommended)",
    dictCancelUpload: "Cancel",
    dictUploadCanceled: "Upload canceled",
    dictInvalidFileType: "Invalid file type. Only images are allowed.",
    dictFileTooBig: "File is too big ({{filesize}}MB). Max filesize: {{maxFilesize}}MB.",
    dictMaxFilesExceeded: "You can not upload more than {{maxFiles}} files.",
    
    init: function() {
        this.on("addedfile", function(file) {
            console.log("File added:", file.name);
        });
        
        this.on("removedfile", function(file) {
            console.log("File removed:", file.name);
        });
        
        this.on("error", function(file, errorMessage) {
            console.error("Upload error:", errorMessage);
            alert("Image upload failed: " + errorMessage);
        });

        // Make remove buttons more reliable on hover/overlay cases
        this.on("addedfile", function(file) {
            setTimeout(function() {
                var preview = file.previewElement;
                if (!preview) return;
                var removeBtn = preview.querySelector(".dz-remove");
                if (removeBtn) {
                    removeBtn.setAttribute('href', '#');
                    removeBtn.setAttribute('role', 'button');
                    removeBtn.style.pointerEvents = 'auto';
                    removeBtn.style.zIndex = '2';
                    removeBtn.addEventListener('click', function(e){
                        e.preventDefault();
                        e.stopPropagation();
                        myDropzone.removeFile(file);
                    });
                }
            }, 0);
        });
    }
});

// Form Submission Handler
document.getElementById('submitPropertyBtn').addEventListener('click', function(e) {
    e.preventDefault();

    // Check if user is logged in
    const token = localStorage.getItem('auth_token') || localStorage.getItem('token');
    if (!token) {
        alert('Please login first to submit a property.');
        window.location.href = 'login.html';
        return;
    }

    // Check if we're in edit mode
    const urlParams = new URLSearchParams(window.location.search);
    const propertyId = urlParams.get('id');
    const isEditMode = !!propertyId;

    // Show full-screen loader
    const fullscreenLoader = document.getElementById('fullscreenLoader');
    const submitBtn = document.getElementById('submitPropertyBtn');
    const submitText = document.getElementById('submitText');
    const submitLoader = document.getElementById('submitLoader');

    // Show full-screen loader
    fullscreenLoader.style.display = 'flex';

    // Disable button and show inline loader as backup
    submitBtn.disabled = true;
    submitText.style.display = 'none';
    submitLoader.style.display = 'inline';

    // Get form data
    const formData = new FormData();

    // Basic Information
    formData.append('title', document.getElementById('title').value);
    formData.append('status', document.getElementById('status').value);
    formData.append('type', document.getElementById('propertyType').value);
    formData.append('totalArea', document.getElementById('totalArea').value);
    formData.append('price', document.getElementById('price').value);

    // Conditional fields
    const bhk = document.getElementById('bhk').value;
    if (bhk) formData.append('bhk', bhk);

    const bathrooms = document.getElementById('bathrooms').value;
    if (bathrooms) formData.append('bathrooms', bathrooms);

    const balconies = document.getElementById('balconies').value;
    if (balconies) formData.append('balconies', balconies);

    const carParking = document.getElementById('carParking').value;
    if (carParking) formData.append('carParking', carParking);

    const buildingAge = document.getElementById('buildingAge').value;
    if (buildingAge) formData.append('buildingAge', buildingAge);

    // Location
    formData.append('address', document.getElementById('address').value);
    (function(){
        var citySel = document.getElementById('city');
        var customCity = document.getElementById('customCity');
        var cityVal = citySel ? citySel.value : '';
        if (cityVal === 'Other' && customCity && customCity.value.trim()) {
            formData.append('city', customCity.value.trim());
        } else {
            formData.append('city', cityVal);
        }
    })();
    formData.append('state', document.getElementById('state').value);
    formData.append('zipCode', document.getElementById('zipCode').value);
    formData.append('latitude', document.getElementById('latitude').value);
    formData.append('longitude', document.getElementById('longitude').value);

    // Land specific fields
    const areaVigha = document.getElementById('areaVigha').value;
    if (areaVigha) formData.append('areaVigha', areaVigha);

    const areaAcre = document.getElementById('areaAcre').value;
    if (areaAcre) formData.append('areaAcre', areaAcre);

    // Land questions
    const landQuestions = ['fencing', 'borewell', 'houseOnLand', 'electricity', 'expectedPricePerUnit', 'paymentTerms', 'legacyLand'];
    landQuestions.forEach(question => {
        const value = document.getElementById(question).value;
        if (value) formData.append(question, value);
    });

    // Amenities
    const amenities = [];
    document.querySelectorAll('input[name="amenities"]:checked').forEach(checkbox => {
        amenities.push(checkbox.value);
    });
    formData.append('amenities', JSON.stringify(amenities));

    // Contact details
    formData.append('contactName', document.getElementById('contactName').value);
    formData.append('contactEmail', document.getElementById('contactEmail').value);
    formData.append('contactPhone', document.getElementById('contactPhone').value);

    const whatsappNumber = document.getElementById('whatsappNumber').value;
    if (whatsappNumber) formData.append('whatsappNumber', whatsappNumber);

    const preferredContact = document.getElementById('preferredContact').value;
    if (preferredContact) formData.append('preferredContact', preferredContact);

    // Detailed information
    const description = document.querySelector('textarea[name="message"]').value;
    if (description) formData.append('description', description);

    // Documents
    const document712 = document.getElementById('document712').files[0];
    if (document712) formData.append('document712', document712);

    const document8A = document.getElementById('document8A').files[0];
    if (document8A) formData.append('document8A', document8A);

    const documentUtarotar = document.getElementById('documentUtarotar').files[0];
    if (documentUtarotar) formData.append('documentUtarotar', documentUtarotar);

    const otherDocuments = document.getElementById('otherDocuments').files;
    for (let i = 0; i < otherDocuments.length; i++) {
        formData.append('otherDocuments', otherDocuments[i]);
    }

    // Get uploaded images from Dropzone and add them to form data
    const uploadedFiles = myDropzone.getAcceptedFiles();
    uploadedFiles.forEach((file, index) => {
        formData.append('images', file);
    });

    // Submit to backend - use PUT for edit, POST for new
    const submitUrl = isEditMode ? `http://localhost:5000/api/properties/${propertyId}` : 'http://localhost:5000/api/properties';
    const submitMethod = isEditMode ? 'PUT' : 'POST';

    fetch(submitUrl, {
        method: submitMethod,
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('auth_token') || localStorage.getItem('token')}`
        },
        body: formData
    })
    .then(response => {
        if (response.status === 401) {
            // Token expired or invalid
            alert('Your session has expired. Please login again.');
            localStorage.removeItem('auth_token');
            localStorage.removeItem('token');
            localStorage.removeItem('current_user');
            window.location.href = 'login.html';
            return;
        }
        return response.json();
    })
    .then(data => {
        // Hide full-screen loader
        fullscreenLoader.style.display = 'none';

        // Hide loading indicator
        submitBtn.disabled = false;
        submitText.style.display = 'inline';
        submitLoader.style.display = 'none';

        if (data && data.success) {
            const action = isEditMode ? 'updated' : 'submitted';
            alert(`Property ${action} successfully!`);
            // Redirect to property details or dashboard
            window.location.href = 'my-properties.html';
        } else if (data) {
            let errorMessage = data.message || 'Unknown error';
            if (data.errors && data.errors.length > 0) {
                errorMessage += '\n\nValidation errors:\n' + data.errors.join('\n');
            }
            alert(`Error ${isEditMode ? 'updating' : 'submitting'} property: ` + errorMessage);
        }
    })
    .catch(error => {
        // Hide full-screen loader
        fullscreenLoader.style.display = 'none';

        // Hide loading indicator
        submitBtn.disabled = false;
        submitText.style.display = 'inline';
        submitLoader.style.display = 'none';

        console.error('Error:', error);
        const action = isEditMode ? 'updating' : 'submitting';
        alert(`Error ${action} property. Please try again.`);
    });
});

// Preview functionality
document.getElementById('previewBtn').addEventListener('click', function(e) {
    e.preventDefault();
    // You can implement a preview modal or redirect to a preview page
    alert('Preview functionality will be implemented');
});

// Form validation
function validateForm() {
    const requiredFields = ['title', 'status', 'propertyType', 'totalArea', 'price', 'address', 'city', 'state', 'contactName', 'contactEmail', 'contactPhone'];
    
    for (let field of requiredFields) {
        const element = document.getElementById(field);
        if (!element.value.trim()) {
            alert(`Please fill in the ${element.previousElementSibling.textContent} field.`);
            element.focus();
            return false;
        }
    }
    
    // Validate coordinates
    const lat = document.getElementById('latitude').value;
    const lng = document.getElementById('longitude').value;
    if (!lat || !lng) {
        alert('Please select a location on the map.');
        return false;
    }
    
    return true;
}

// Add validation to submit button
document.getElementById('submitPropertyBtn').addEventListener('click', function(e) {
    if (!validateForm()) {
        e.preventDefault();
        return false;
    }
});

// Check authentication and initialize page
document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('auth_token') || localStorage.getItem('token');
    const currentUser = localStorage.getItem('current_user');

    if (!token || !currentUser) {
        alert('Please login to access this page.');
        window.location.href = 'login.html';
        return;
    }

    // Parse user data and populate contact fields if available
    try {
        const user = JSON.parse(currentUser);
        if (user.name) {
            document.getElementById('contactName').value = user.name;
        }
        if (user.email) {
            document.getElementById('contactEmail').value = user.email;
        }
        if (user.phone) {
            document.getElementById('contactPhone').value = user.phone;
        }
    } catch (error) {
        console.error('Error parsing user data:', error);
    }

    // Check if we're in edit mode (URL contains property ID)
    const urlParams = new URLSearchParams(window.location.search);
    const propertyId = urlParams.get('id');

    if (propertyId) {
        // Edit mode - load existing property data
        loadPropertyForEdit(propertyId);
        updatePageForEditMode();
    } else {
        // New property mode - update page for new submission
        updatePageForNewMode();
    }
});

// Load existing property data for editing
async function loadPropertyForEdit(propertyId) {
    try {
        const token = localStorage.getItem('auth_token') || localStorage.getItem('token');
        const response = await fetch(`http://localhost:5000/api/properties/${propertyId}`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (response.ok) {
            const data = await response.json();
            if (data.status === 'success' && data.data) {
                populateFormWithPropertyData(data.data);
            } else {
                alert('Property not found or access denied.');
                window.location.href = 'my-properties.html';
            }
        } else {
            alert('Error loading property data.');
            window.location.href = 'my-properties.html';
        }
    } catch (error) {
        console.error('Error loading property:', error);
        alert('Error loading property data.');
        window.location.href = 'my-properties.html';
    }
}

// Populate form fields with existing property data
function populateFormWithPropertyData(property) {
    // Basic Information
    document.getElementById('title').value = property.title || '';
    document.getElementById('status').value = property.status || '';
    document.getElementById('propertyType').value = property.type || '';
    document.getElementById('totalArea').value = property.specifications?.area || property.totalArea || '';
    document.getElementById('price').value = property.price || '';

    // Conditional fields based on property type
    if (property.bhk) {
        document.getElementById('bhk').value = property.bhk;
        document.getElementById('bhkContainer').style.display = 'block';
    }
    if (property.bathrooms) {
        document.getElementById('bathrooms').value = property.bathrooms;
        document.getElementById('bathroomsContainer').style.display = 'block';
    }
    if (property.balconies !== undefined) {
        document.getElementById('balconies').value = property.balconies;
        document.getElementById('balconiesContainer').style.display = 'block';
    }
    if (property.carParking) {
        document.getElementById('carParking').value = property.carParking;
        document.getElementById('carParkingContainer').style.display = 'block';
    }
    if (property.buildingAge) {
        document.getElementById('buildingAge').value = property.buildingAge;
        document.getElementById('buildingAgeContainer').style.display = 'block';
    }

    // Location
    document.getElementById('address').value = property.location?.address || '';
    document.getElementById('state').value = property.location?.state || '';
    document.getElementById('zipCode').value = property.location?.zipCode || '';

    // Set city (handle custom cities)
    if (property.location?.city) {
        const citySelect = document.getElementById('city');
        const customCity = document.getElementById('customCity');

        // Check if city exists in dropdown options
        const cityExists = Array.from(citySelect.options).some(option =>
            option.value === property.location.city
        );

        if (cityExists) {
            citySelect.value = property.location.city;
        } else {
            // Use custom city option
            citySelect.value = 'Other';
            customCity.value = property.location.city;
            customCity.style.display = 'block';
        }
    }

    // Coordinates
    if (property.location?.coordinates) {
        document.getElementById('latitude').value = property.location.coordinates.latitude || '';
        document.getElementById('longitude').value = property.location.coordinates.longitude || '';
    }

    // Land specific fields
    if (property.areaVigha) {
        document.getElementById('areaVigha').value = property.areaVigha;
        document.getElementById('landAreaContainer').style.display = 'block';
    }
    if (property.areaAcre) {
        document.getElementById('areaAcre').value = property.areaAcre;
    }

    // Land questions
    const landQuestions = ['fencing', 'borewell', 'houseOnLand', 'electricity', 'expectedPricePerUnit', 'paymentTerms', 'legacyLand'];
    landQuestions.forEach(question => {
        if (property.landInfo && property.landInfo[question]) {
            document.getElementById(question).value = property.landInfo[question];
            document.getElementById('landQuestionsContainer').style.display = 'block';
        }
    });

    // Description
    if (property.description) {
        document.querySelector('textarea[name="message"]').value = property.description;
    }

    // Refresh select pickers to show updated values
    if (window.jQuery && jQuery.fn.selectpicker) {
        jQuery('.selectpicker').selectpicker('refresh');
    }
}

// Update page UI for edit mode
function updatePageForEditMode() {
    // Update page title
    document.querySelector('.page-name h1').textContent = 'Edit Property';
    document.querySelector('.page-name ul li:last-child span').textContent = 'Edit Property';

    // Update submit button text
    const submitBtn = document.getElementById('submitPropertyBtn');
    if (submitBtn) {
        submitBtn.textContent = 'Update Property';
    }
}

// Update page UI for new property mode
function updatePageForNewMode() {
    // Ensure correct titles for new property submission
    document.querySelector('.page-name h1').textContent = 'Submit Property';
    document.querySelector('.page-name ul li:last-child span').textContent = 'Submit Property';

    // Update submit button text
    const submitBtn = document.getElementById('submitPropertyBtn');
    if (submitBtn) {
        submitBtn.textContent = 'Submit Property';
    }
}
</script>

<style>
/* Scoped to submit property page only */
.submit-property .form-group label,
.submit-property .input-text,
.submit-property .form-control { color: #000 !important; }

/* Native selects */
.submit-property select.search-fields { color: #000 !important; background-color: #fff !important; }

/* Bootstrap-select styled dropdowns */
.submit-property .bootstrap-select > .dropdown-toggle { color: #000 !important; background-color: #fff !important; }
.submit-property .bootstrap-select .filter-option { color: #000 !important; }
.submit-property .bootstrap-select .dropdown-menu { background-color: #fff !important; }
.submit-property .bootstrap-select .dropdown-menu.inner li a span.text { color: #000 !important; }
.submit-property .bootstrap-select .dropdown-menu li a { color: #000 !important; }

/* Radio/checkbox labels inside submit property */
.submit-property .checkbox label,
.submit-property .radio label { color: #000 !important; }

/* Dropzone helper text */
.submit-property .dropzone .dz-message,
.submit-property .dropzone .dz-message span,
.submit-property .dropzone .dz-message p { color: #000 !important; }

/* Google Places Autocomplete dropdown - force readable colors */
.pac-container { z-index: 99999 !important; background: #fff !important; color: #000 !important; }
.pac-container .pac-item { color: #000 !important; }
.pac-container .pac-item .pac-icon { filter: none !important; }
.pac-container .pac-item .pac-item-query { color: #000 !important; }
.pac-container .pac-item:hover { background: #f1f1f1 !important; }
</style>

</body>
</html>
